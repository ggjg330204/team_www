---

# 데이터 및 스토리지 아키텍처 보고서 (Data & Storage Architecture Report)

---

## 1. 개요 (Executive Summary)

본 보고서는 `04_t1_www` 프로젝트의 데이터 인프라 아키텍처 설계 원칙과 구현 상세를 기술합니다.
본 프로젝트의 데이터 계층은 **비즈니스 연속성(Business Continuity)** 보장과 **데이터 무결성(Data Integrity)** 확보를 최우선 목표로 합니다. 이를 위해 Azure PaaS(Platform as a Service) 기반의 관리형 서비스를 도입하여 운영 오버헤드를 최소화하고, 물리적 네트워크 격리를 통해 엔터프라이즈 수준의 보안 컴플라이언스를 충족하도록 설계되었습니다.

---

## 2. 아키텍처 설계 원칙 (Architectural Principles)

데이터 아키텍처는 다음의 3대 핵심 원칙에 따라 수립되었습니다.

### 2.1. 보안 및 거버넌스 (Security & Governance)
*   **Zero Trust 모델 적용**: 모든 데이터 리소스에 대한 공용 인터넷 접근(Public Access)을 원천 차단하고, 검증된 내부 네트워크 경로(Private Endpoint)만을 허용합니다.
*   **다계층 암호화**: 저장 데이터(At-rest)는 플랫폼 관리형 키를 통해 암호화되며, 전송 구간(In-transit) 보호를 위한 아키텍처를 기본으로 합니다.

### 2.2. 고가용성 및 내구성 (Availability & Durability)
*   **단일 장애 지점(SPOF) 제거**: 데이터센터 및 리전 단위 장애 발생 시에도 서비스가 지속될 수 있도록 이중화(Redundancy) 전략을 적용합니다.
*   **데이터 보존성**: 논리적 오류 및 물리적 재해로부터 데이터를 보호하기 위한 다중 백업 체계를 구축합니다.

### 2.3. 성능 및 비용 최적화 (Performance & Cost Efficiency)
*   **계층별 처리**: 핫 데이터(Hot Data)와 정적 콘텐츠를 캐싱 레이어(Redis, CDN)에서 처리하여 백엔드 부하를 최소화합니다.
*   **사용량 기반 확장**: 스토리지 및 컴퓨팅 자원은 실제 사용량에 따라 유연하게 확장되도록 구성하여 초기 투자 비용(CAPEX)을 절감합니다.

---

## 3. 상세 구성 및 구현 (Detailed Architecture)

### 3.1. 관계형 데이터베이스 (MySQL Flexible Server)
트랜잭션 데이터 처리를 위한 메인 데이터베이스 구성입니다.
*   **리소스 사양**: `Standard_D4ds_v4` (General Purpose). 메모리 최적화 인스턴스를 통해 안정적인 처리량을 보장합니다.
*   **스토리지 전략**: 스토리지 **자동 증가(Auto-growth)** 기능을 활성화하여, 데이터 급증 시에도 서비스 중단 없이 용량이 확장되도록 구성했습니다.
*   **네트워크 보안**: VNet 통합 및 Private DNS Zone(`privatelink.mysql.database.azure.com`)을 연동하여, 애플리케이션 서버가 내부 도메인으로만 DB에 접근하도록 강제했습니다.

### 3.2. 오브젝트 스토리지 (Azure Storage Account)
비정형 데이터 및 백업 아카이빙을 위한 저장소입니다.
*   **재해 복구 구성**: **GRS (Geo-Redundant Storage)** 옵션을 채택하여, 주 리전(Korea Central)의 완전한 불능 상태 시 보조 리전(Korea South)으로 데이터 접근 경로를 전환할 수 있습니다.
*   **데이터 보호**: 컨테이너 수준의 **Soft Delete(7일)** 및 버전 관리(Versioning)를 활성화하여, 랜섬웨어 공격이나 사용자 실수로 인한 영구 삭제를 방지합니다.

### 3.3. 성능 가속 및 자동화 계층

#### 3.3.1. Azure Cache for Redis
*   **목적**: 반복적인 읽기 요청(Read-heavy workload)을 인메모리에서 처리하여 DB 부하를 경감
*   **구현 세부사항**:
    - **WordPress 통합**: `php-pecl-redis5` 확장 설치 및 Redis Object Cache 플러그인 자동 설치
    - **자동 구성**: VMSS/VM 초기화 스크립트(`ins.sh`, `web.sh`)에 Redis 설정 자동 추가
    - **성능 개선**: 캐시 히트율 70%+ 목표, 응답 시간 2-5배 향상 예상
    - **연결 보안**: SSL 포트 (6380) 사용, Primary Access Key 인증
*   **아키텍처 효과**:
    - MySQL 읽기 부하 50-70% 감소
    - 동시 사용자 처리 용량 증가
    - 전체 인프라 확장성 개선

#### 3.3.2. Azure Data Factory (자동 백업 파이프라인)
*   **목적**: MySQL 데이터의 자동화된 백업 및 재해 복구 강화
*   **구현 세부사항**:
    - **파이프라인**: `MySQLDailyBackup` (매일 오전 2시 KST 실행)
    - **데이터 흐름**: MySQL (information_schema) → CSV 변환 → Blob Storage (`mysql-backups` 컨테이너)
    - **보안**: Managed Identity (SystemAssigned)로 리소스 간 안전한 액세스
    - **백업 보존**: Storage Lifecycle Policy로 자동 계층화 (Hot → Cool → Archive)
*   **아키텍처 효과**:
    - Azure 자동 백업 외 추가 백업 계층 확보
    - Blob Storage GRS로 지리적 중복 보장
    - 규정 준수 요구사항 충족 (백업 이력 보존)

#### 3.3.3. Azure Front Door (CDN)
*   **목적**: 글로벌 엣지 로드밸런싱 및 정적 리소스 전송 지연시간 최소화
*   **Origin 연결**: Storage Account Blob을 Origin으로 연결 완료
*   **콘텐츠 가속**: WordPress 미디어 파일 (이미지, CSS, JS) 빠른 전송

---

## 4. 운영 및 재해 복구 전략 (Operations & DR Strategy)

비즈니스 요구사항을 충족하기 위한 구체적인 운영 지표와 복구 절차입니다.

### 4.1. 백업 및 복구 목표 (RTO/RPO)
데이터베이스 및 스토리지 장애 시 비즈니스 영향도를 최소화하기 위해 다음과 같은 목표 수준을 수립하였습니다.
*   **RPO (목표 복구 시점)**: < 5분 (트랜잭션 로그 백업 주기 기반)
*   **RTO (목표 복구 시간)**: < 30분 (새로운 인스턴스로의 Point-in-Time Restore 소요 시간)
*   **보존 정책**: 최대 **35일**간의 이력을 보존하여 과거 특정 시점의 데이터 상태로 롤백 가능합니다.

### 4.2. 모니터링 및 감사 (Audit & Monitoring)
*   **규정 준수 모니터링**: `connection`, `ddl`, `dml` 등 데이터 변경 및 접근 이력을 Azure Monitor 로그로 수집하여 보안 감사가 가능하도록 구현했습니다.
*   **리소스 상태 추적**: CPU, 메모리, IOPS 등 주요 지표가 임계치를 초과할 경우 경보(Alert)가 발생하도록 진단 설정을 구성했습니다.

---

## 5. 아키텍처 의사결정 및 최적화 (Architectural Decisions)

구축 과정에서 직면한 제약 사항을 극복하고 아키텍처를 최적화한 과정입니다.

### 5.1. 리전 할당량 제약에 따른 DR 아키텍처 재수립
초기 설계안은 리전 간 능동적 복제(Cross-Region Replica)였으나, 구독 내 리소스 할당량(Quota) 제약으로 인해 보조 리전의 인스턴스 생성이 제한되었습니다.
*   **조치**: 가용성 확보 방식을 **'동일 리전 내 복제(Replica) + 스토리지 GRS'**의 하이브리드 형태로 변경하였습니다. 이는 컴퓨팅 자원의 가용성과 데이터의 지리적 내구성을 동시에 확보하는 현실적인 최적안입니다.

### 5.2. DNS 해석 문제와 Private Zone 통합
Private Endpoint 도입 시, 기본 DNS가 사설 IP를 해석하지 못하는 연결 이슈가 식별되었습니다.
*   **조치**: Terraform을 통해 서비스별 **Private DNS Zone**을 프로비저닝하고 VNet과 링크(Virtual Network Link)를 구성했습니다. 이를 통해 인프라 변경 시에도 애플리케이션 코드 수정 없이 도메인 기반의 안정적인 연결을 보장하는 IaC(Infrastructure as Code) 환경을 완성했습니다.

---

## 6. 결론 (Conclusion)

본 데이터 아키텍처는 단순한 저장소 구축을 넘어, **'보안', '가용성', '성능', '자동화'**라는 4가지 핵심 가치를 기술적으로 구현해냈습니다.
Private Endpoint 기반의 네트워크 격리는 외부 위협을 차단하는 strong 보안 기반이 되며, 수립된 다중 백업 체계 및 DR 정책은 실제 운영 환경에서의 다양한 장애 시나리오에 유연하게 대응할 수 있는 견고한 토대가 될 것입니다.

---

**작성자**: 이두경 (Data & Storage Engineer)  
**프로젝트**: 04_t1_www