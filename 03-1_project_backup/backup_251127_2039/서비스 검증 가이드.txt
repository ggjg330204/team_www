## 3. ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸

**ì£¼ì˜**: ì´ ë‹¨ê³„ëŠ” **ì›¹ ì„œë²„(Web VM)** ì— ì ‘ì†í•œ ìƒíƒœì—ì„œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

### 3.1 MySQL ì ‘ì†
ì›¹ ì„œë²„ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¡œ MySQLì— ì ‘ì†í•´ ë´…ë‹ˆë‹¤.
```bash
# 1. SSL ì¸ì¦ì„œ ë‹¤ìš´ë¡œë“œ (í•„ìˆ˜)
wget https://dl.cacerts.digicert.com/DigiCertGlobalRootG2.crt.pem

# 2. ì ‘ì† ì‹œë„
mysql -h <MySQL_ì£¼ì†Œ> -u www -p --ssl-ca=DigiCertGlobalRootG2.crt.pem
```
- **ë¹„ë°€ë²ˆí˜¸**: `terraform.tfvars`ì— ì„¤ì •í•œ `db_password`ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
- **í…ŒìŠ¤íŠ¸**: `SHOW DATABASES;` ë¥¼ ì…ë ¥í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ì´ ë³´ì´ë©´ ì—°ê²° ì„±ê³µì…ë‹ˆë‹¤.

### 3.2 Redis ìºì‹œ ì ‘ì†
ì›¹ ì„œë²„ì—ì„œ Redis ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
```bash
# ì ‘ì† ì‹œë„ (SSL í¬íŠ¸ 6380)
redis-cli -h <Redis_ì£¼ì†Œ> -p 6380 -a <Redis_í‚¤> --tls
```
- **í…ŒìŠ¤íŠ¸**: `PING` ì´ë¼ê³  ì…ë ¥í–ˆì„ ë•Œ `PONG` ì´ë¼ê³  ëŒ€ë‹µí•˜ë©´ ì •ìƒì…ë‹ˆë‹¤. ğŸ“

---

## 4. â˜ï¸ ìŠ¤í† ë¦¬ì§€ ë° ì„œë²„ë¦¬ìŠ¤ ê¸°ëŠ¥

### 4.1 ì´ë¯¸ì§€ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ (Azure Storage)
1. **Azure Portal**ì— ë¡œê·¸ì¸í•©ë‹ˆë‹¤.
2. **Storage Account** (`www...`)ë¥¼ ì°¾ì•„ ë“¤ì–´ê°‘ë‹ˆë‹¤.
3. **Containers** ë©”ë‰´ì—ì„œ `images` ì»¨í…Œì´ë„ˆë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
4. **Upload** ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•„ë¬´ ì´ë¯¸ì§€ íŒŒì¼(jpg, png)ì´ë‚˜ ì—…ë¡œë“œí•´ ë³´ì„¸ìš”.

### 4.2 ìë™ ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• (ì°¸ê³ )
*í˜„ì¬ Event Grid êµ¬ë… ì„¤ì •ì€ Azure Portalì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì—°ê²°í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.*
1. ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ Event Gridê°€ íŠ¸ë¦¬ê±°ë˜ì–´ Functionì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
2. **Containers** ë©”ë‰´ì˜ `thumbnails` ì»¨í…Œì´ë„ˆì— ë¦¬ì‚¬ì´ì§•ëœ ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

---

## 5. ğŸ›¡ï¸ ë³´ì•ˆ ë° ëª¨ë‹ˆí„°ë§

### 5.1 ë³´ì•ˆ ì ìˆ˜ í™•ì¸ (Defender for Cloud)
1. Azure Portal ê²€ìƒ‰ì°½ì— **"Microsoft Defender for Cloud"** ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
2. ë°°í¬ëœ ë¦¬ì†ŒìŠ¤ë“¤ì´ ë³´í˜¸ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. (VM, SQL, Storage ë“±)

### 5.2 ì•Œë¦¼ í…ŒìŠ¤íŠ¸ (Metric Alerts)
1. Azure Portal > **Monitor** > **Alerts** ë¡œ ì´ë™í•©ë‹ˆë‹¤.
2. `Alert rules`ë¥¼ í´ë¦­í•˜ì—¬ `High-CPU-VMSS` ë“±ì˜ ê·œì¹™ì´ ì˜ ë§Œë“¤ì–´ì ¸ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

---

## 6. ğŸ³ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (ACR)

Docker ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
```bash
# ë¡œê·¸ì¸
az acr login --name <ACR_ì´ë¦„>

# í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ ì—…ë¡œë“œ
docker pull hello-world
docker tag hello-world <ACR_ì£¼ì†Œ>/hello-world:v1
docker push <ACR_ì£¼ì†Œ>/hello-world:v1
```
- Azure Portalì˜ **Container registries** > **Repositories** ì—ì„œ `hello-world`ê°€ ë³´ì´ë©´ ì„±ê³µì…ë‹ˆë‹¤.

---

## 7. ğŸ“Š ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë° ëª¨ë‹ˆí„°ë§ ê²€ì¦

### 7.1 k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸

**k6 ì„¤ì¹˜** (Windows):
```powershell
# Chocolateyë¥¼ ì´ìš©í•œ ì„¤ì¹˜
choco install k6

# ë˜ëŠ” Scoopì„ ì´ìš©í•œ ì„¤ì¹˜
scoop install k6
```

**ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸** (`load_test.js`):
```javascript
// ì›¹ ì„œë¹„ìŠ¤ ë¶€í•˜ í…ŒìŠ¤íŠ¸
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  stages: [
    { duration: '30s', target: 10 },  // 10ëª…ìœ¼ë¡œ ì¦ê°€
    { duration: '1m', target: 50 },   // 50ëª…ìœ¼ë¡œ ì¦ê°€
    { duration: '30s', target: 100 }, // 100ëª…ìœ¼ë¡œ ì¦ê°€
    { duration: '1m', target: 0 },    // ì²œì²œíˆ ì¢…ë£Œ
  ],
  thresholds: {
    http_req_duration: ['p(95)<500'], // 95%ê°€ 500ms ì´í•˜
    http_req_failed: ['rate<0.01'],   // ì‹¤íŒ¨ìœ¨ 1% ì´í•˜
  },
};

export default function () {
  const url = __ENV.TARGET_URL || 'http://LOAD_BALANCER_IP';
  
  const res = http.get(url);
  check(res, {
    'status is 200': (r) => r.status === 200,
    'response time < 500ms': (r) => r.timings.duration < 500,
  });
  
  sleep(1);
}
```

**ì‹¤í–‰**:
```powershell
# í™˜ê²½ë³€ìˆ˜ ì„¤ì • í›„ ì‹¤í–‰
$env:TARGET_URL = "http://<LOAD_BALANCER_IP>"
k6 run load_test.js
```

**í™•ì¸í•  ì§€í‘œ**:
- âœ… `http_req_duration` P95 < 500ms
- âœ… `http_req_failed` < 1%
- âœ… Auto-Scaling íŠ¸ë¦¬ê±° (CPU > 70%)

### 7.2 Apache Bench (ê°„ë‹¨í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸)

```powershell
# Apache Bench ì„¤ì¹˜ (Apache httpdì— í¬í•¨)
# Windows: https://www.apachelounge.com/download/ ì—ì„œ ë‹¤ìš´ë¡œë“œ

# ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
ab -n 1000 -c 10 http://<LOAD_BALANCER_IP>/

# -n 1000: ì´ 1000ê°œ ìš”ì²­
# -c 10: ë™ì‹œ 10ê°œ ì—°ê²°
```

**ê²°ê³¼ í•´ì„**:
- `Requests per second`: ì´ˆë‹¹ ì²˜ë¦¬ ìš”ì²­ ìˆ˜ (ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ)
- `Time per request`: í‰ê·  ì‘ë‹µ ì‹œê°„ (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)
- `Failed requests`: ì‹¤íŒ¨í•œ ìš”ì²­ ìˆ˜ (0ì´ì–´ì•¼ í•¨)

### 7.3 ê°€ìš©ì„± í…ŒìŠ¤íŠ¸ (PowerShell ìŠ¤í¬ë¦½íŠ¸)

**ìë™ ê°€ìš©ì„± ì²´í¬** (`availability_test.ps1`):
```powershell
# ì›¹ ì„œë¹„ìŠ¤ ê°€ìš©ì„± ëª¨ë‹ˆí„°ë§ (5ë¶„ë§ˆë‹¤ ì²´í¬)
param(
    [string]$Url = "http://<LOAD_BALANCER_IP>",
    [int]$IntervalSeconds = 300
)

while ($true) {
    try {
        $response = Invoke-WebRequest -Uri $Url -TimeoutSec 10 -UseBasicParsing
        $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        
        if ($response.StatusCode -eq 200) {
            Write-Host "[$timestamp] âœ… OK - Status: $($response.StatusCode)" -ForegroundColor Green
        } else {
            Write-Host "[$timestamp] âš ï¸ WARNING - Status: $($response.StatusCode)" -ForegroundColor Yellow
        }
    }
    catch {
        $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        Write-Host "[$timestamp] âŒ FAILED - Error: $($_.Exception.Message)" -ForegroundColor Red
    }
    
    Start-Sleep -Seconds $IntervalSeconds
}
```

**ì‹¤í–‰**:
```powershell
.\availability_test.ps1 -Url "http://<LOAD_BALANCER_IP>" -IntervalSeconds 60
```

### 7.4 Log Analytics ì¿¼ë¦¬ (KQL)

**Azure Portal** â†’ **Log Analytics Workspace** â†’ **Logs**ì—ì„œ ì‹¤í–‰:

**1. NSG Flow ë¡œê·¸ ë¶„ì„ (ë¹„ì •ìƒ íŠ¸ë˜í”½ íƒì§€)**:
```kql
AzureNetworkAnalytics_CL
| where TimeGenerated > ago(1h)
| summarize Count=count() by SrcIP_s, DestPort_d, FlowStatus_s
| where Count > 100
| order by Count desc
```

**2. ì›¹ ì„œë²„ ì‘ë‹µ ì‹œê°„ ë¶„ì„**:
```kql
AppRequests
| where TimeGenerated > ago(1h)
| summarize 
    AvgDuration=avg(DurationMs),
    P95Duration=percentile(DurationMs, 95),
    P99Duration=percentile(DurationMs, 99),
    FailureRate=countif(Success == false) * 100.0 / count()
by bin(TimeGenerated, 5m)
| render timechart
```

**3. MySQL ì—°ê²° ì‹¤íŒ¨ ë¡œê·¸**:
```kql
AzureDiagnostics
| where ResourceType == "MYSQL"
| where Category == "MySqlSlowLogs" or Category == "MySqlAuditLogs"
| where TimeGenerated > ago(1h)
| where Message contains "failed" or Message contains "error"
```

### 7.5 Azure Monitor CLI (ë©”íŠ¸ë¦­ í™•ì¸)

**ì„¤ì¹˜**:
```powershell
# Azure CLI í™•ì¥ ì„¤ì¹˜
az extension add --name monitor-control-service
```

**VMSS CPU ì‚¬ìš©ë¥  í™•ì¸**:
```powershell
az monitor metrics list `
  --resource "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/www-rg/providers/Microsoft.Compute/virtualMachineScaleSets/my-vmss" `
  --metric "Percentage CPU" `
  --start-time (Get-Date).AddHours(-1).ToString('yyyy-MM-ddTHH:mm:ss') `
  --end-time (Get-Date).ToString('yyyy-MM-ddTHH:mm:ss') `
  --interval PT1M `
  --aggregation Average
```

**MySQL ì—°ê²° ìˆ˜ í™•ì¸**:
```powershell
az monitor metrics list `
  --resource "/subscriptions/<SUBSCRIPTION_ID>/resourceGroups/www-rg/providers/Microsoft.DBforMySQL/flexibleServers/www-mysql-server-*" `
  --metric "active_connections" `
  --aggregation Average
```

### 7.6 ë³´ì•ˆ ê²€ì¦

**NSG ê·œì¹™ í…ŒìŠ¤íŠ¸**:
```powershell
# Bastion ì™¸ë¶€ì—ì„œ ì§ì ‘ VMSS SSH ì ‘ì† ì‹œë„ (ì°¨ë‹¨ë˜ì–´ì•¼ í•¨)
Test-NetConnection -ComputerName <VMSS_PRIVATE_IP> -Port 22 -InformationLevel Detailed
# ê²°ê³¼: TcpTestSucceeded: False (ì°¨ë‹¨ë¨)

# HTTP/HTTPS ì ‘ì† í…ŒìŠ¤íŠ¸ (í—ˆìš©ë˜ì–´ì•¼ í•¨)
Test-NetConnection -ComputerName <LOAD_BALANCER_IP> -Port 80 -InformationLevel Detailed
# ê²°ê³¼: TcpTestSucceeded: True (í—ˆìš©ë¨)
```

**Private Endpoint ì—°ê²° í™•ì¸**:
```powershell
# Web VMì—ì„œ MySQL Private Endpointë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
# (Web VMì— SSH ì ‘ì†í•œ ìƒíƒœì—ì„œ)
nslookup <MYSQL_SERVER>.mysql.database.azure.com
# ê²°ê³¼: Private IP (172.16.1.x)ê°€ ë°˜í™˜ë˜ì–´ì•¼ í•¨

# Public IP ì¡°íšŒ ì‹œë„ (ë¹„í™œì„±í™”ë˜ì–´ì•¼ í•¨)
ping <MYSQL_SERVER>.mysql.database.azure.com
# ê²°ê³¼: Private IPë¡œë§Œ ì‘ë‹µ
```

### 7.7 ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…/ë³µêµ¬ í…ŒìŠ¤íŠ¸

**Data Factory Pipeline ìˆ˜ë™ íŠ¸ë¦¬ê±°**:
```powershell
# Azure CLIë¡œ Data Factory Pipeline ì‹¤í–‰
az datafactory pipeline create-run `
  --resource-group www-rg `
  --factory-name www-adf `
  --name mysql-backup-pipeline

# Pipeline ì‹¤í–‰ ìƒíƒœ í™•ì¸
az datafactory pipeline-run show `
  --resource-group www-rg `
  --factory-name www-adf `
  --run-id <RUN_ID>
```

**ë°±ì—… íŒŒì¼ í™•ì¸**:
```powershell
# Storage Accountì— ë°±ì—… íŒŒì¼ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
az storage blob list `
  --account-name <STORAGE_ACCOUNT_NAME> `
  --container-name backup `
  --query "[?contains(name, 'www_sql_backup')].{Name:name, Size:properties.contentLength, Modified:properties.lastModified}"
```

**MySQL ë ˆí”Œë¦¬ì¹´ ë™ê¸°í™” í™•ì¸**:
```sql
-- Primary ì„œë²„ì—ì„œ ì‹¤í–‰
SHOW MASTER STATUS;

-- Replica ì„œë²„ì—ì„œ ì‹¤í–‰
SHOW SLAVE STATUS\G

-- Seconds_Behind_Master ê°’ì´ 1ì´ˆ ì´í•˜ë©´ ì •ìƒ ë™ê¸°í™”
```

### 7.8 Metric Alert íŠ¸ë¦¬ê±° í…ŒìŠ¤íŠ¸

**CPU ë¶€í•˜ ìƒì„±** (Web VMì—ì„œ):
```bash
# CPU 100% ë¶€í•˜ ìƒì„± (3ë¶„ ì´ìƒ ìœ ì§€)
stress-ng --cpu 4 --timeout 300s

# ë˜ëŠ” ê°„ë‹¨í•œ ë¬´í•œ ë£¨í”„
yes > /dev/null &
# ì¢…ë£Œ: killall yes
```

**Alert í™•ì¸**:
1. Azure Portal â†’ **Monitor** â†’ **Alerts**
2. 3-5ë¶„ í›„ `High-CPU-VMSS` Alert ë°œìƒ í™•ì¸
3. Email/SMS ì•Œë¦¼ ìˆ˜ì‹  í™•ì¸
4. Auto-Scaling ë™ì‘ í™•ì¸ (VMSS ì¸ìŠ¤í„´ìŠ¤ ì¦ê°€)

---

## â“ ë¬¸ì œê°€ ìƒê²¼ë‚˜ìš”?


- **ì ‘ì†ì´ ì•ˆ ë¼ìš”**: `terraform output` ëª…ë ¹ì–´ë¡œ IPê°€ ë§ëŠ”ì§€ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.
- **DB ì—°ê²° ì‹¤íŒ¨**: Web VM ë‚´ë¶€ì—ì„œë§Œ ì ‘ì† ê°€ëŠ¥í•©ë‹ˆë‹¤. ë¡œì»¬ PCì—ì„œëŠ” ì ‘ì†í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ë³´ì•ˆ ì •ì±…).
- **ê¶Œí•œ ì˜¤ë¥˜**: `az login`ì´ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.