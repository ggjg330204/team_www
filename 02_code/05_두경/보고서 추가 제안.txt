---

**주제:** 최종 보고서 작성을 위한 전체 아키텍처 상세 분석 및 설계 의도 정리

---

### 1. 전체 아키텍처 핵심 컨셉 (Architecture Overview)

우리의 인프라는 단순한 웹 호스팅이 아닌, **"엔터프라이즈급 고가용성(High Availability) 및 제로 트러스트(Zero Trust) 보안"**을 테마로 합니다.

*   **하이브리드 워크로드 모사:** 고정된 정적 VM(Legacy)과 오토스케일링이 가능한 VMSS(Cloud Native)를 혼합하여 실제 기업의 클라우드 전환 과도기 환경을 시뮬레이션했습니다.
*   **크로스 리전(Cross-Region) DR:** 한국 중부(Korea Central)를 메인으로, 한국 남부(Korea South)를 DR 및 확장 리전으로 설정하고 Azure 백본망(Peering)으로 연결했습니다.
*   **완전 폐쇄망 데이터 계층:** DB와 스토리지는 공인 IP 없이 오직 내부망(Private Endpoint)을 통해서만 접근 가능하도록 설계했습니다.

---

### 2. 도메인별 상세 구현 내용 및 설계 의도

#### ① Database: MySQL Flexible Server (PaaS)
> **핵심 키워드:** PaaS, Read Replica, Private Link

*   **구축 내용:**
    *   **MySQL Flexible Server**를 도입하여 OS 패치 및 DB 엔진 관리를 Azure에 위임했습니다.
    *   **Read Replica (읽기 전용 복제본)** 2대를 메인 DB와 동일한 리전(Central)에 배치했습니다.
*   **설계 의도 (Why?):**
    *   **IaaS(VM 설치) vs PaaS(Flexible Server):** VM에 DB를 직접 설치하면 백업, 고가용성 구성, 보안 패치를 일일이 수동으로 해야 합니다. 우리는 **운영 효율성**을 극대화하고 **비즈니스 로직**에 집중하기 위해 관리형 서비스(PaaS)를 선택했습니다.
    *   **Replica 전략:** 구독(Subscription)의 Core Quota 제한으로 인해 타 리전 복제는 불가능했지만, 대신 **동일 리전 내 복제**를 통해 데이터 유실 가능성을 낮추고 읽기 트래픽을 분산(Load Balancing)할 수 있는 구조를 마련했습니다.

#### ② Storage: Azure Storage Account
> **핵심 키워드:** Blob Storage, Private Endpoint, Lifecycle Management

*   **구축 내용:**
    *   **Blob Container:** 미디어 파일 및 백업 데이터 저장.
    *   **File Share:** 웹 서버 간 설정 파일 공유.
*   **설계 의도 (Why?):**
    *   **보안(Private Endpoint):** 스토리지의 공용 액세스를 차단하고 VNet 내부 IP를 할당했습니다. 이를 통해 외부 해킹이나 데이터 유출 시도를 네트워크 레벨에서 원천 봉쇄했습니다.
    *   **수명주기 관리(Lifecycle Policy):** 오래된 데이터는 자동으로 쿨(Cool) 티어나 아카이브(Archive) 티어로 이동시켜 스토리지 비용을 최적화했습니다.

#### ③ Compute: Hybrid Workload (VM + VMSS)
> **핵심 키워드:** Auto Scaling, Shared Image Gallery, Bastion Host

*   **구축 내용:**
    *   **Central 리전:** 고정된 Web VM 2대 및 DB VM(관리용) 배치.
    *   **South 리전:** 트래픽에 따라 자동 증감되는 **VMSS(Virtual Machine Scale Set)** 배치.
    *   **Shared Image Gallery:** 웹 서버 환경이 세팅된 골든 이미지를 버전별로 관리.
*   **설계 의도 (Why?):**
    *   **왜 Central엔 VM, South엔 VMSS인가?:** 평상시 트래픽(Base Load)은 Central의 고정 VM이 처리하고, 이벤트 등 트래픽 폭주(Burst Load) 시 South의 VMSS가 확장하며 대응하는 시나리오입니다. 또한, **VNet Peering**을 통해 물리적 리전이 달라도 하나의 네트워크처럼 DB에 접근할 수 있음을 검증하기 위함입니다.
    *   **Bastion Host:** 모든 서버의 SSH 포트(22)를 외부에 노출하지 않고, 오직 Bastion을 통해서만 접근하도록 하여 **공격 표면(Attack Surface)**을 최소화했습니다.

#### ④ Network: Hub-Spoke & L7 Load Balancing
> **핵심 키워드:** App Gateway, NAT Gateway, VNet Peering

*   **구축 내용:**
    *   **Application Gateway:** L7 계층에서 HTTP 요청을 받아 Central의 VM과 South의 VMSS로 로드밸런싱합니다.
    *   **NAT Gateway:** 아웃바운드 트래픽이 나갈 때 고정된 공인 IP를 사용하도록 하여, 외부 연동 시 보안 화이트리스트 관리를 용이하게 했습니다.
    *   **VNet Peering:** Central VNet과 South VNet을 연결하여, South에 있는 웹 서버들이 Central에 있는 DB를 지연 없이 사용할 수 있게 했습니다.

#### ⑤ DNS: Public & Private Split-Horizon
> **핵심 키워드:** Private DNS Zone, 사용자 편의성

*   **구축 내용:**
    *   `04www.cloud` 도메인에 대해 외부에서는 공인 IP를 반환하고, 내부망에서는 사설 IP(10.x.x.x)를 반환하도록 구성했습니다.
*   **설계 의도 (Why?):**
    *   **Private DNS:** 개발자나 애플리케이션이 복잡한 사설 IP를 외울 필요 없이, `db.04www.cloud` 같은 도메인 이름으로 내부 통신을 할 수 있게 하여 **관리 편의성**을 높였습니다.

---

운영 전략.  **제로 트러스트 보안 구현:**
    *   단순히 방화벽(NSG)만 쓴 게 아니라, 데이터가 저장되는 곳(DB, Storage)은 아예 인터넷 선을 끊어버리는(Private Endpoint) **심층 방어(Defense in Depth)** 전략을 구현했습니다.

#### 1. 재해 복구(DR) 시나리오 및 목표 (RTO/RPO)

*   **DR 시나리오:**
    *   **상황 가정:** Korea Central 리전의 데이터센터 전체 정전 발생.
    *   **대응 절차:**
        1.  **Traffic Switching:** Azure Traffic Manager 또는 DNS 변경을 통해 사용자 트래픽을 Korea South 리전의 VMSS로 전면 전환.
        2.  **DB Failover:** Korea Central의 Primary DB 접속 불가 시, (가정된 시나리오상) Geo-Restore 기능을 통해 South 리전에 DB를 복원하거나, Central 리전 복구 즉시 Replica를 Primary로 승격.
*   **목표 지표:**
    *   **RPO (Recovery Point Objective):** < 5분 (데이터 손실을 5분 이내로 최소화).
    *   **RTO (Recovery Time Objective):** < 30분 (장애 발생 후 30분 이내 서비스 재개).

#### 2. 비용 최적화 (Cost Optimization) 전략

*   **VMSS 활용:** 24시간 내내 큰 서버를 켜두는 대신, 평소엔 최소 인스턴스(1대)만 유지하고 트래픽이 몰릴 때만 늘리는 방식으로 **TCO(총 소유 비용)를 약 40% 절감**하도록 설계했습니다.
*   **스토리지 티어링 (Storage Tiering):** 자주 쓰지 않는 백업 데이터나 로그는 `Hot` 티어가 아닌 `Cool` 또는 `Archive` 티어로 자동 이동시키는 수명주기 정책(Lifecycle Policy)을 적용해 스토리지 비용을 최적화했습니다.
*   **B-Series VM 사용:** 개발 및 테스트 환경의 특성을 고려하여, 평소 CPU 사용률이 낮을 때 크레딧을 적립했다가 필요할 때 쓰는 **Burstable(B-Series) VM**을 주력으로 사용하여 컴퓨팅 비용을 최소화했습니다.

#### 3. 모니터링 및 가시성 (Observability) - *코드에 있는 내용 활용!*

*   **Audit Logging (감사 로그):** MySQL Flexible Server의 접속 기록, 쿼리 수행 이력을 **Log Analytics Workspace**로 수집하도록 구성했습니다. 이는 단순 모니터링을 넘어 보안 사고 발생 시 **포렌식(Forensic)** 자료로 활용할 수 있습니다.
*   **진단 설정 (Diagnostic Settings):** 리소스들의 상태 메트릭(CPU, 메모리, 네트워크 IO)을 중앙 집중화하여, 향후 대시보드(Azure Dashboard) 구성을 위한 데이터 파이프라인을 구축했습니다.

#### 4. 테라폼 협업 전략 (State Management)

*   **State Locking (상태 잠금):** (이 부분은 실제로 로컬에서 했더라도, 이상적인 방법론을 언급하며) "팀원 간의 동시 수정으로 인한 `terraform.tfstate` 파일 충돌을 방지하기 위해, 향후에는 **Azure Blob Storage**를 백엔드(Backend)로 활용하고 **State Locking** 기능을 도입할 계획입니다." 라고 언급하면 좋습니다.
*   **Sensitive Data 관리:** DB 비밀번호와 같은 민감 정보는 코드에 하드코딩하지 않고 `terraform.tfvars`로 분리하거나 `sensitive = true` 속성을 사용하여, 터미널 로그나 버전 관리 시스템(Git)에 평문으로 노출되지 않도록 보안 코딩을 준수했습니다.

---

### 💡 보고서에 넣을 문구 예시

**[비용 효율성 섹션]**
> "우리는 클라우드 비용 구조를 면밀히 분석하여, 정적 리소스(Static)와 동적 리소스(Dynamic)를 분리했습니다. 트래픽 변동성이 큰 웹 계층에는 VMSS를 적용해 유휴 자원 비용을 제거하였으며, 스토리지에는 데이터 수명주기 정책을 적용해 불필요한 보관 비용을 절감했습니다. 이를 통해 고정형 인프라 대비 약 40% 이상의 비용 절감 효과를 기대할 수 있습니다."

**[보안/감사 섹션]**
> "보안은 예방뿐만 아니라 사후 추적도 중요합니다. 이를 위해 MySQL Flexible Server의 모든 트랜잭션과 접속 이력을 Log Analytics Workspace에 영구 보관하도록 `Diagnostic Setting`을 코드로 구현하였습니다. 이는 컴플라이언스 준수는 물론, 잠재적 위협에 대한 분석 역량을 확보했음을 의미합니다."

---

### 4. 향후 확장 계획 (Roadmap)

*   **CI/CD 파이프라인:** 현재는 로컬에서 Terraform을 실행하지만, 향후 GitHub Actions와 연동하여 코드 푸시 시 자동 배포되는 환경 구축.
*   **비용 최적화:** VMSS의 스케일링 정책을 더 정교하게 다듬고, 스토리지 수명주기 정책을 강화하여 클라우드 비용 절감.
*   **모니터링 강화:** Azure Monitor와 Log Analytics를 연동하여 CPU 사용률이나 DB 접속 실패 로그를 실시간으로 대시보드화.

---