# ì½”ë“œ ë¦¬íŒ©í† ë§ ë° í†µí•© ë¦¬í¬íŠ¸

## âœ… ê°œìš”
ì—¬ëŸ¬ ëª…ì´ ì‘ì„±í•œ Terraform ì½”ë“œë¥¼ í†µí•©í•˜ë©´ì„œ ë°œìƒí•œ ëª¨ë“ˆ ê°„ ì˜ì¡´ì„±, ë³€ìˆ˜ ë¶ˆì¼ì¹˜, ë¦¬ì†ŒìŠ¤ ì¤‘ë³µ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê³ , ì²´ê³„ì ì¸ ë¦¬íŒ©í† ë§ì„ í†µí•´ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ê°€ë…ì„±ì„ ëŒ€í­ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤. ë³¸ ë¬¸ì„œëŠ” 1ì°¨ í†µí•© ì‘ì—…ì˜ ë°°ê²½ê³¼ 2ì°¨ ë¦¬íŒ©í† ë§ì˜ ìƒì„¸ ë‚´ì—­, ê·¸ë¦¬ê³  ìµœì¢…ì ì¸ í”„ë¡œì íŠ¸ êµ¬ì¡°ì™€ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ìˆ í•©ë‹ˆë‹¤.

> **ğŸ’¡ í•™ìŠµ í¬ì¸íŠ¸**: Terraformì—ì„œ ëª¨ë“ˆ ê°„ì˜ ë°ì´í„° íë¦„(Input Variable/Output Value)ê³¼ ì˜ì¡´ì„± ê´€ë¦¬ê°€ ì™œ ì¤‘ìš”í•œì§€ ì¤‘ì ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## 1. ë°°ê²½: 1ì°¨ í†µí•© ì‘ì—… (ì„ í–‰ ì‘ì—…)

ë¦¬íŒ©í† ë§ ì´ì „ì— ìˆ˜í–‰ëœ 1ì°¨ í†µí•© ê³¼ì •ì—ì„œ í•´ê²°ëœ ì£¼ìš” ë¬¸ì œë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

### 1.1 ëª¨ë“ˆ ê°„ ê²½ê³„ ë¶ˆëª…í™• í•´ê²°
- **ë¬¸ì œ**: Network ëª¨ë“ˆê³¼ Compute ëª¨ë“ˆ ì–‘ìª½ì— VM ë¦¬ì†ŒìŠ¤ê°€ ì¤‘ë³µ ì •ì˜ë˜ì–´ ìˆì—ˆìœ¼ë©°, Compute ëª¨ë“ˆì´ Network ëª¨ë“ˆì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ëŠ” ë“± ê²½ê³„ê°€ ëª¨í˜¸í–ˆìŠµë‹ˆë‹¤.
- **í•´ê²°**: VM ë¦¬ì†ŒìŠ¤ë¥¼ Compute ëª¨ë“ˆë¡œ ì¼ì›í™”í•˜ê³ , Network ëª¨ë“ˆì—ì„œ ì¤‘ë³µëœ `10_vm.tf`ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.

### 1.2 ë³€ìˆ˜ ë° ì˜ì¡´ì„± ì²´ê³„í™” (ìƒì„¸)
Terraform ëª¨ë“ˆì€ ë…ë¦½ì ì´ì–´ì•¼ í•˜ë©°, í•„ìš”í•œ ê°’ì€ ë°˜ë“œì‹œ **ë³€ìˆ˜(Variable)**ë¥¼ í†µí•´ ì£¼ì…ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.

- **ë¬¸ì œ ìƒí™©**:
  Compute ëª¨ë“ˆì— `variables.tf` íŒŒì¼ì´ ì•„ì˜ˆ ì—†ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ `main.tf`ì—ì„œëŠ” ë³€ìˆ˜ë¥¼ ì „ë‹¬í•˜ë ¤ê³  ì‹œë„í•˜ê³  ìˆì—ˆê³ , ë‚´ë¶€ ì½”ë“œì—ì„œëŠ” ì™¸ë¶€ ë¦¬ì†ŒìŠ¤(NIC ë“±)ë¥¼ í•˜ë“œì½”ë”©ìœ¼ë¡œ ì°¸ì¡°í•˜ê±°ë‚˜ ì°¾ì§€ ëª»í•´ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

- **í•´ê²° ë°©ë²•**:
  `modules/Compute/100_variables.tf` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì…êµ¬ê°€ ë˜ëŠ” ë³€ìˆ˜ë“¤ì„ ëª…í™•íˆ ì •ì˜í–ˆìŠµë‹ˆë‹¤.

  **[ë³€ê²½ ì „: ì—ëŸ¬ ë°œìƒ]**
  ```hcl
  # modules/Compute/01_virtual_machines.tf (ê°€ìƒ)
  resource "azurerm_linux_virtual_machine" "web" {
    # ...
    # ë¬¸ì œ: ì™¸ë¶€ ëª¨ë“ˆì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ë ¤ í•¨ (ë¶ˆê°€ëŠ¥)
    network_interface_ids = [azurerm_network_interface.web_nic.id] 
  }
  ```

  **[ë³€ê²½ í›„: ë³€ìˆ˜ë¥¼ í†µí•œ ì£¼ì…]**
  ```hcl
  # modules/Compute/100_variables.tf
  variable "nic_id" {
    description = "Map of Network Interface IDs from Network module"
    type        = map(string)
  }

  # modules/Compute/01_virtual_machines.tf
  resource "azurerm_linux_virtual_machine" "web" {
    # ...
    # í•´ê²°: ë³€ìˆ˜ë¡œ ì „ë‹¬ë°›ì€ ID ì‚¬ìš©
    network_interface_ids = [var.nic_id["web1_nic"]]
  }
  ```

### 1.3 ëª¨ë“ˆ ì¶œë ¥(Outputs) ë³´ì™„ (ìƒì„¸)
í•œ ëª¨ë“ˆì—ì„œ ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ì˜ IDë‚˜ IP ì£¼ì†Œë¥¼ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ ë°˜ë“œì‹œ **ì¶œë ¥(Output)**ìœ¼ë¡œ ë‚´ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.

- **ë¬¸ì œ ìƒí™©**:
  Network ëª¨ë“ˆì´ `subnet_id`, `vnet_id` ë“±ì„ ì¶œë ¥í•˜ì§€ ì•Šì•„, Databaseë‚˜ Storage ëª¨ë“ˆì´ ì´ ë„¤íŠ¸ì›Œí¬ ìœ„ì— ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

- **í•´ê²° ë°©ë²•**:
  Network ëª¨ë“ˆì˜ `99_outputs.tf`ì— í•„ìš”í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ IDë¥¼ ì¶œë ¥í•˜ë„ë¡ ì½”ë“œë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

  **[ì¶”ê°€ëœ ì½”ë“œ ì˜ˆì‹œ: modules/Network/99_outputs.tf]**
  ```hcl
  output "vnet_id" {
    description = "The ID of the Primary VNet (Korea Central)"
    value       = azurerm_virtual_network.www_vnet.id
  }

  output "db_subnet_id" {
    description = "The ID of the Database Subnet"
    value       = azurerm_subnet.www_db.id
  }
  ```

  **[í™œìš© ì˜ˆì‹œ: ë£¨íŠ¸ main.tf]**
  ```hcl
  module "db" {
    source = "./modules/Database"
    # ...
    # Network ëª¨ë“ˆì˜ ì¶œë ¥ì„ DB ëª¨ë“ˆì˜ ì…ë ¥ìœ¼ë¡œ ì—°ê²°
    vnet_id      = module.network.vnet_id
    db_subnet_id = module.network.db_subnet_id
  }
  ```

---

## 2. 2ì°¨ ë¦¬íŒ©í† ë§ ìƒì„¸ (ì™„ë£Œ)

1ì°¨ í†µí•© ì´í›„, íŒŒì¼ êµ¬ì¡°ì˜ ì¼ê´€ì„±ê³¼ ì½”ë“œ í’ˆì§ˆì„ ë†’ì´ê¸° ìœ„í•´ 2ì°¨ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.

### Phase 1: íŒŒì¼ ìœ„ì¹˜ ì¬ì¡°ì •
íŒŒì¼ì˜ ì„±ê²©ì— ë”°ë¼ ì˜¬ë°”ë¥¸ ë””ë ‰í† ë¦¬ë¡œ ì¬ë°°ì¹˜í•˜ì—¬ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ì •ëˆí–ˆìŠµë‹ˆë‹¤.

1. âœ… **ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ì´ë™**
   - `modules/Network/*.sh` â†’ `scripts/` ë””ë ‰í† ë¦¬ë¡œ ì´ë™
   - ëŒ€ìƒ: `bas.sh`, `db.sh`, `key.sh`, `web.sh`

2. âœ… **SSH í‚¤ íŒŒì¼ ì´ë™**
   - `modules/Network/id_ed25519.pub` â†’ `ssh/` ë””ë ‰í† ë¦¬ë¡œ ì´ë™

3. âœ… **ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œê±°**
   - ì˜ëª»ëœ ìœ„ì¹˜ì— ìƒì„±ëœ `terraform.tfstate`, `terraform.tfstate.backup`, `terraform.tfvars` ì‚­ì œ

### Phase 2: íŒŒì¼ ì´ë¦„ ì •ê·œí™”
ëª¨ë“ˆë³„ë¡œ ì œê°ê°ì´ë˜ íŒŒì¼ ë„˜ë²„ë§ì„ `01`ë¶€í„° ì‹œì‘í•˜ëŠ” ìˆœì°¨ì ì¸ ë²ˆí˜¸ë¡œ í†µì¼í•˜ê³ , íŒŒì¼ëª…ì— ë¦¬ì†ŒìŠ¤ì˜ ì—­í• ì„ ëª…í™•íˆ ëª…ì‹œí–ˆìŠµë‹ˆë‹¤.

4. âœ… **Network ëª¨ë“ˆ (10ê°œ íŒŒì¼)**
   - `03_sub.tf` â†’ `03_subnet.tf`
   - `04_pub.tf` â†’ `04_public_ip.tf`
   - `07_nat.tf` â†’ `06_nat_gateway.tf` (ìˆœì„œ ì¬ì •ë ¬)
   - `08_natsub.tf` â†’ `07_nat_association.tf`
   - ...

5. âœ… **Compute ëª¨ë“ˆ (5ê°œ íŒŒì¼)**
   - `10_vm.tf` â†’ `01_virtual_machines.tf`
   - `14_gallery.tf` â†’ `02_shared_image_gallery.tf`
   - ...

### Phase 3: ë³€ìˆ˜ ë° ì¶œë ¥ ì •ë¦¬ (ìƒì„¸)
ì½”ë“œì˜ ê°„ê²°ì„±ê³¼ ê°€ë…ì„±ì„ ìœ„í•´ ë¶ˆí•„ìš”í•œ ë³€ìˆ˜ë¥¼ ì œê±°í•˜ê³  ëª…ì¹­ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

7. âœ… **ë¯¸ì‚¬ìš© ë³€ìˆ˜ ëŒ€ê±° ì œê±° (vnet-*)**
   - **ë°°ê²½**: ì´ˆê¸° ê°œë°œ ì‹œ VNet ì •ë³´ë¥¼ ê°œë³„ ë³€ìˆ˜(`vnet-bas`, `vnet-web` ë“±)ë¡œ ìª¼ê°œì„œ ì „ë‹¬í•˜ë ¤ í–ˆìœ¼ë‚˜, ì‹¤ì œë¡œëŠ” `vnet_id` í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ ë˜ê±°ë‚˜ ì•„ì˜ˆ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ì•˜ìŠµë‹ˆë‹¤.
   - **í•´ê²°**: ë¶ˆí•„ìš”í•œ ë³€ìˆ˜ 14ê°œë¥¼ ì œê±°í•˜ì—¬ ì½”ë“œ ë³µì¡ë„ë¥¼ íšê¸°ì ìœ¼ë¡œ ë‚®ì·„ìŠµë‹ˆë‹¤.

   **[main.tf ì½”ë“œ ë¹„êµ]**
   ```diff
   module "network" {
     source = "./modules/Network"
     # ...
   - vnet-bas  = var.vnet-bas  # ì‚­ì œ
   - vnet-nat  = var.vnet-nat  # ì‚­ì œ
   - vnet-load = var.vnet-load # ì‚­ì œ
   - vnet-web1 = var.vnet-web1 # ì‚­ì œ
     # ... (ì´ 7ì¤„ ì‚­ì œ)
   }
   ```
   > **íš¨ê³¼**: `main.tf`ì˜ ëª¨ë“ˆ í˜¸ì¶œ ì½”ë“œê°€ 33ì¤„ì—ì„œ 19ì¤„ë¡œ 42% ê°ì†Œí•˜ì—¬ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì‰¬ì›Œì¡ŒìŠµë‹ˆë‹¤.

8. âœ… **ë³€ìˆ˜ëª… ê°œì„  (loca1 â†’ loca_replica)**
   - **ë¬¸ì œ**: `loca1`ì´ë¼ëŠ” ë³€ìˆ˜ëª…ì€ "ì²« ë²ˆì§¸ ìœ„ì¹˜"ì¸ì§€ "ë˜ ë‹¤ë¥¸ ìœ„ì¹˜"ì¸ì§€ ì˜ë¯¸ê°€ ëª¨í˜¸í–ˆìŠµë‹ˆë‹¤.
   - **í•´ê²°**: `loca_replica`ë¡œ ë³€ê²½í•˜ì—¬ "DB ë³µì œë³¸ì´ ìœ„ì¹˜í•  ë¦¬ì „"ì„ì„ ëª…í™•íˆ í–ˆìŠµë‹ˆë‹¤.

### Phase 4: ì½”ë“œ êµ¬ì¡° ê°œì„  (ê²½ë¡œ ë° í•˜ë“œì½”ë”©)
ì‹¤í–‰ í™˜ê²½ì— êµ¬ì• ë°›ì§€ ì•ŠëŠ” ê²¬ê³ í•œ ì½”ë“œë¡œ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

9. âœ… **ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš© (`path.root`)**
   - **ë¬¸ì œ**: `./ssh/key.pub`ì™€ ê°™ì´ ìƒëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ë©´, Terraformì„ ì‹¤í–‰í•˜ëŠ” ìœ„ì¹˜(ë””ë ‰í† ë¦¬)ì— ë”°ë¼ íŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - **í•´ê²°**: Terraform ë‚´ì¥ ë³€ìˆ˜ì¸ `path.root`ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê¸°ì¤€ì˜ ì ˆëŒ€ ê²½ë¡œë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.

   **[ì½”ë“œ ë¹„êµ]**
   ```hcl
   # ë³€ê²½ ì „ (ìœ„í—˜)
   public_key = file("./ssh/id_ed25519.pub")

   # ë³€ê²½ í›„ (ì•ˆì „)
   # path.rootëŠ” main.tfê°€ ìˆëŠ” ìµœìƒìœ„ ë””ë ‰í† ë¦¬ë¥¼ ê°€ë¦¬í‚´
   public_key = file("${path.root}/ssh/id_ed25519.pub")
   ```

10. âœ… **í•˜ë“œì½”ë”© ì œê±°**
    - `02_vnet.tf` ë“±ì—ì„œ í•˜ë“œì½”ë”©ëœ ë¦¬ì „ëª…("KoreaSouth")ì„ `var.loca_replica` ë³€ìˆ˜ë¡œ ëŒ€ì²´í•˜ì—¬, ë‚˜ì¤‘ì— ë¦¬ì „ì„ ë³€ê²½í•  ë•Œ ë³€ìˆ˜ íŒŒì¼ í•˜ë‚˜ë§Œ ìˆ˜ì •í•˜ë©´ ë˜ë„ë¡ ìœ ì—°ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.

11. âœ… **Compute ëª¨ë“ˆ ì¶œë ¥ ì¶”ê°€**
    - `99_outputs.tf`ë¥¼ ì‹ ê·œ ìƒì„±í•˜ì—¬ VM ID, VMSS ID ë“±ì„ ì¶œë ¥í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¶”í›„ ëª¨ë‹ˆí„°ë§ì´ë‚˜ ë‹¤ë¥¸ ìë™í™” ë„êµ¬ì™€ ì—°ë™í•  ë•Œ í•„ìˆ˜ì ì¸ ì •ë³´ì…ë‹ˆë‹¤.

---

## 3. ğŸ“ ìµœì¢… í”„ë¡œì íŠ¸ êµ¬ì¡°

```
g:\Project2\11.25.ì½”ë“œí†µí•©\
â”œâ”€â”€ ğŸ“„ 00_provider.tf           # Terraform ë° Azure í”„ë¡œë°”ì´ë” ì„¤ì •
â”œâ”€â”€ ğŸ“„ 01_variables.tf          # ë£¨íŠ¸ ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ ğŸ“„ 02_main.tf               # ëª¨ë“ˆ í˜¸ì¶œ ë° ì—°ê²° (ë©”ì¸)
â”œâ”€â”€ ğŸ“„ 03_entraid.tf            # Azure AD ì‚¬ìš©ì ë°ì´í„° ì†ŒìŠ¤
â”œâ”€â”€ ğŸ“„ 04_rbac.tf               # RBAC ì—­í•  í• ë‹¹
â”œâ”€â”€ ğŸ“„ 05_azure_policy.tf       # Azure Policy í• ë‹¹
â”œâ”€â”€ ğŸ“„ terraform.tfvars         # ë³€ìˆ˜ ê°’ ì„¤ì •
â”œâ”€â”€ ğŸ“„ tfplan                   # Terraform í”Œëœ íŒŒì¼
â”œâ”€â”€ ğŸ“„ .terraform.lock.hcl      # í”„ë¡œë°”ì´ë” ë²„ì „ ë½ íŒŒì¼
â”œâ”€â”€ ğŸ“„ ì½”ë“œ ë¦¬íŒ©í† ë§.md          # ë³¸ ë¬¸ì„œ
â”‚
â”œâ”€â”€ ğŸ“ .terraform\              # Terraform í”„ë¡œë°”ì´ë” ìºì‹œ
â”‚
â”œâ”€â”€ ğŸ“ modules\
â”‚   â”œâ”€â”€ ğŸ“ Network\             # ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ 00_init.tf          # í”„ë¡œë°”ì´ë” ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ 01_rg.tf            # ë¦¬ì†ŒìŠ¤ ê·¸ë£¹
â”‚   â”‚   â”œâ”€â”€ 02_vnet.tf          # ê°€ìƒ ë„¤íŠ¸ì›Œí¬
â”‚   â”‚   â”œâ”€â”€ 03_subnet.tf        # ì„œë¸Œë„· (vnet0, vnet1)
â”‚   â”‚   â”œâ”€â”€ 04_public_ip.tf     # ê³µì¸ IP
â”‚   â”‚   â”œâ”€â”€ 05_nic.tf           # ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ 06_nat_gateway.tf   # NAT ê²Œì´íŠ¸ì›¨ì´
â”‚   â”‚   â”œâ”€â”€ 07_nat_association.tf  # ì„œë¸Œë„·-NAT ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ 08_load_balancer.tf    # ë¡œë“œ ë°¸ëŸ°ì„œ
â”‚   â”‚   â”œâ”€â”€ 09_lb_backend_pool.tf  # ë°±ì—”ë“œ í’€
â”‚   â”‚   â”œâ”€â”€ 10_lb_backend_address.tf  # ë°±ì—”ë“œ ì£¼ì†Œ
â”‚   â”‚   â”œâ”€â”€ 11_vnet_peering.tf     # VNet í”¼ì–´ë§
â”‚   â”‚   â”œâ”€â”€ 99_outputs.tf       # ì¶œë ¥ ê°’ (ë‹¤ë¥¸ ëª¨ë“ˆë¡œ ì „ë‹¬)
â”‚   â”‚   â””â”€â”€ 100_variables.tf    # ì…ë ¥ ë³€ìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Compute\             # ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ 01_virtual_machines.tf     # ê°€ìƒ ë¨¸ì‹  (Bastion, Web, DB)
â”‚   â”‚   â”œâ”€â”€ 02_shared_image_gallery.tf # ê³µìœ  ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬
â”‚   â”‚   â”œâ”€â”€ 03_vmss.tf          # ê°€ìƒ ë¨¸ì‹  ìŠ¤ì¼€ì¼ ì…‹
â”‚   â”‚   â”œâ”€â”€ 04_autoscaling.tf   # ìë™ ìŠ¤ì¼€ì¼ë§ ê·œì¹™
â”‚   â”‚   â”œâ”€â”€ 99_outputs.tf       # ì¶œë ¥ ê°’
â”‚   â”‚   â””â”€â”€ 100_variables.tf    # ì…ë ¥ ë³€ìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Database\            # ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ 01_server.tf        # MySQL Flexible Server
â”‚   â”‚   â”œâ”€â”€ 02_db.tf            # ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
â”‚   â”‚   â”œâ”€â”€ 03_replica.tf       # ë³µì œë³¸ ì„œë²„
â”‚   â”‚   â”œâ”€â”€ 04_config.tf        # ì„œë²„ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ 05_pe.tf            # Private Endpoint
â”‚   â”‚   â”œâ”€â”€ 06_redis.tf         # Redis Cache
â”‚   â”‚   â”œâ”€â”€ 07_adf.tf           # Azure Data Factory
â”‚   â”‚   â”œâ”€â”€ 08_cosmos.tf.disabled  # Cosmos DB (ë¹„í™œì„±í™”)
â”‚   â”‚   â”œâ”€â”€ 09_audit.tf         # ê°ì‚¬ ë¡œê·¸
â”‚   â”‚   â”œâ”€â”€ 99_outputs.tf       # ì¶œë ¥ ê°’
â”‚   â”‚   â””â”€â”€ 100_variables.tf    # ì…ë ¥ ë³€ìˆ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ Security\            # ë³´ì•ˆ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ 01_network_security_groups.tf  # NSG ì •ì˜
â”‚   â”‚   â”œâ”€â”€ 02_nsg_associations.tf  # NSG-ì„œë¸Œë„· ì—°ê²°
â”‚   â”‚   â””â”€â”€ 100_variables.tf    # ì…ë ¥ ë³€ìˆ˜
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ Storage\             # ìŠ¤í† ë¦¬ì§€ ëª¨ë“ˆ
â”‚       â”œâ”€â”€ 01_st_acct.tf       # ìŠ¤í† ë¦¬ì§€ ê³„ì •
â”‚       â”œâ”€â”€ 02_container.tf     # Blob ì»¨í…Œì´ë„ˆ
â”‚       â”œâ”€â”€ 03_life_policy.tf   # ìˆ˜ëª… ì£¼ê¸° ì •ì±…
â”‚       â”œâ”€â”€ 04_cdn_prof.tf      # CDN í”„ë¡œí•„
â”‚       â”œâ”€â”€ 05_cdn_end.tf       # CDN ì—”ë“œí¬ì¸íŠ¸
â”‚       â”œâ”€â”€ 06_pe.tf            # Private Endpoint
â”‚       â”œâ”€â”€ 07_fileshare.tf     # íŒŒì¼ ê³µìœ 
â”‚       â”œâ”€â”€ 08_premium.tf       # Premium Storage
â”‚       â”œâ”€â”€ 99_outputs.tf       # ì¶œë ¥ ê°’
â”‚       â””â”€â”€ 100_variables.tf    # ì…ë ¥ ë³€ìˆ˜
â”‚
â”œâ”€â”€ ğŸ“ scripts\                 # ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ bas.sh                  # Bastion í˜¸ìŠ¤íŠ¸ ì„¤ì •
â”‚   â”œâ”€â”€ db.sh                   # DB ì„œë²„ ì„¤ì •
â”‚   â”œâ”€â”€ ins.sh                  # VMSS ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •
â”‚   â”œâ”€â”€ key.sh                  # SSH í‚¤ ì„¤ì •
â”‚   â””â”€â”€ web.sh                  # ì›¹ ì„œë²„ ì„¤ì •
â”‚
â””â”€â”€ ğŸ“ ssh\                     # SSH í‚¤ íŒŒì¼
    â”œâ”€â”€ id_ed25519              # Private Key
    â””â”€â”€ id_ed25519.pub          # Public Key
```

**íŒŒì¼ ëª…ëª… ê·œì¹™**:
- `00_*.tf`: í”„ë¡œë°”ì´ë” ë° ì´ˆê¸° ì„¤ì •
- `01~99_*.tf`: ë¦¬ì†ŒìŠ¤ ì •ì˜ (ë²ˆí˜¸ ìˆœ ìƒì„±)
- `99_outputs.tf`: ëª¨ë“ˆ ì¶œë ¥ ê°’
- `100_variables.tf`: ëª¨ë“ˆ ì…ë ¥ ë³€ìˆ˜

---

## 4. ğŸ—ï¸ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### 4.1 ëª¨ë“ˆ ì˜ì¡´ì„± ê·¸ë˜í”„

```mermaid
flowchart TD
    %% --- ìŠ¤íƒ€ì¼ ì •ì˜ (ë‹¤í¬ ëª¨ë“œ) ---
    classDef root fill:#424242,stroke:#fff,stroke-width:2px,color:#fff,rx:5
    classDef net fill:#1a237e,stroke:#7986cb,stroke-width:2px,color:#fff,rx:5
    classDef compute fill:#e65100,stroke:#ffb74d,stroke-width:2px,color:#fff,rx:5
    classDef security fill:#b71c1c,stroke:#ef9a9a,stroke-width:2px,color:#fff,rx:5
    classDef data fill:#1b5e20,stroke:#81c784,stroke-width:2px,color:#fff,rx:5

    %% --- ë…¸ë“œ ì •ì˜ ---
    subgraph Root_Layer ["ğŸ•¹ï¸ ë£¨íŠ¸ ì»¨í…ìŠ¤íŠ¸ (Root)"]
        Main("ë©”ì¸ ì‹¤í–‰ (main.tf)"):::root
    end

    subgraph Core_Layer ["ğŸŒ í•µì‹¬ ì¸í”„ë¼ (Core)"]
        direction TB
        N_Core[("ê°€ìƒ ë„¤íŠ¸ì›Œí¬<br/>(VNet / Subnet)")]:::net
        N_Out[["ì¶œë ¥ê°’<br/>(outputs.tf)"]]:::net
        N_Core -.-> N_Out
    end

    subgraph Resource_Layer ["ğŸ“¦ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¦¬ì†ŒìŠ¤"]
        direction LR
        S_NSG["ğŸ›¡ï¸ ë³´ì•ˆ ê·¸ë£¹<br/>(NSG)"]:::security
        C_VM["âš™ï¸ ì»´í“¨íŒ…<br/>(VM / VMSS)"]:::compute
        DB_Res[("ğŸ›¢ï¸ ë°ì´í„°ë² ì´ìŠ¤<br/>(SQL / Redis)")]:::data
        ST_Res[("ğŸ’¾ ìŠ¤í† ë¦¬ì§€<br/>(Storage)")]:::data
    end

    %% --- ì—°ê²°ì„  ---
    %% ì„  ìƒ‰ìƒ ë°ê²Œ (ë‹¤í¬ëª¨ë“œìš©)
    linkStyle default stroke:#b0bec5,stroke-width:2px

    %% Main -> Modules
    Main ==> N_Core
    Main --> S_NSG
    Main --> C_VM
    Main --> DB_Res
    Main --> ST_Res

    %% ì˜ì¡´ì„± íë¦„
    N_Out -.-> |ì„œë¸Œë„· ID| S_NSG
    N_Out ==> |ì„œë¸Œë„·/NIC ì—°ê²°| C_VM
    N_Out -.-> |VNet ì—°ë™| DB_Res
    N_Out -.-> |ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸| ST_Res

    %% ë…¼ë¦¬ì  ì—°ê²°
    ST_Res -.-> |ì—°ê²° ë¬¸ìì—´| DB_Res
```

### 4.2 ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ (3-Tier Architecture)

```mermaid
flowchart TB
    %% --- ë‹¤í¬ í…Œë§ˆ ìŠ¤íƒ€ì¼ ì •ì˜ ---
    classDef cloud fill:#263238,stroke:#546e7a,stroke-width:2px,color:#eceff1,rx:10
    classDef region fill:#37474f,stroke:#90a4ae,stroke-width:2px,stroke-dasharray: 5 5,color:#fff,rx:5
    classDef layer fill:#455a64,stroke:#78909c,stroke-width:1px,color:#eceff1,rx:5

    classDef user fill:#000,stroke:#fff,stroke-width:2px,color:#fff,shape:circle
    classDef lb fill:#006064,stroke:#4dd0e1,stroke-width:2px,color:#fff,rx:5
    classDef web fill:#0d47a1,stroke:#64b5f6,stroke-width:2px,color:#fff,rx:5
    classDef app fill:#4a148c,stroke:#e1bee7,stroke-width:2px,color:#fff,rx:5
    classDef db fill:#1b5e20,stroke:#a5d6a7,stroke-width:2px,color:#fff,shape:cyl
    classDef bastion fill:#e65100,stroke:#ffcc80,stroke-width:2px,color:#fff

    %% --- ë‹¤ì´ì–´ê·¸ë¨ êµ¬ì¡° ---

    User(("&nbsp;ğŸ‘± ì‚¬ìš©ì (User)&nbsp;")):::user

    %% Azure í´ë¼ìš°ë“œ ì˜ì—­
    subgraph Cloud ["â˜ï¸ Microsoft Azure í´ë¼ìš°ë“œ"]
        direction TB

        %% íŠ¸ë˜í”½ ì§„ì…
        subgraph Ingress ["ğŸš¦ íŠ¸ë˜í”½ ì§„ì…ì "]
            LB["âš–ï¸ ë¡œë“œ ë°¸ëŸ°ì„œ"]:::lb
        end

        %% ë¦¬ì „ 1: í•œêµ­ ì¤‘ë¶€
        subgraph KR_Central ["ğŸ‡°ğŸ‡· í•œêµ­ ì¤‘ë¶€ (ë©”ì¸ ë¦¬ì „)"]
            direction TB
            
            subgraph Mgmt_Layer ["ê´€ë¦¬ ì˜ì—­ (Mgmt)"]
                Bastion["ğŸ›¡ï¸ ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸"]:::bastion
            end

            subgraph Web_Layer ["ì›¹ ê³„ì¸µ (Web Tier)"]
                WebVM1["ğŸ–¥ï¸ ì›¹ ì„œë²„ 1"]:::web
                WebVM2["ğŸ–¥ï¸ ì›¹ ì„œë²„ 2"]:::web
            end
            
            subgraph Data_Layer_1 ["ë°ì´í„° ê³„ì¸µ (Data Tier)"]
                MySQL_Pri[("ğŸ›¢ï¸ MySQL (ë©”ì¸)")]:::db
                Storage["ğŸ“¦ ìŠ¤í† ë¦¬ì§€ ê³„ì •"]:::db
            end
        end

        %% ë¦¬ì „ 2: í•œêµ­ ë‚¨ë¶€
        subgraph KR_South ["ğŸ‡°ğŸ‡· í•œêµ­ ë‚¨ë¶€ (ì¬í•´ë³µêµ¬/í™•ì¥)"]
            direction TB
            
            subgraph App_Layer ["ì•± ê³„ì¸µ (App Tier)"]
                VMSS["âš™ï¸ VM ìŠ¤ì¼€ì¼ ì…‹"]:::app
            end

            subgraph Data_Layer_2 ["ë°ì´í„° ë³µì œ (Replica)"]
                MySQL_Rep[("ğŸ›¢ï¸ MySQL (ë³µì œë³¸)")]:::db
            end
        end
    end

    %% --- ì—°ê²°ì„  ---
    linkStyle default stroke:#cfd8dc,stroke-width:2px

    User ==> LB
    User -.-> |SSH ì ‘ì†| Bastion

    LB ==> |HTTP/S| WebVM1 & WebVM2
    LB -.-> |íŠ¸ë˜í”½ ë¶„ì‚°| VMSS

    Bastion -.-> |ê´€ë¦¬ ì ‘ì†| WebVM1 & WebVM2 & VMSS

    WebVM1 & WebVM2 --> |ì¿¼ë¦¬| MySQL_Pri
    VMSS --> |ë¡œì§ ì²˜ë¦¬| MySQL_Pri

    MySQL_Pri -.-> |ë°ì´í„° ë™ê¸°í™”| MySQL_Rep

    %% --- ìŠ¤íƒ€ì¼ ì ìš© ---
    class Cloud cloud
    class KR_Central,KR_South region
    class Ingress,Mgmt_Layer,Web_Layer,Data_Layer_1,Data_Layer_2,App_Layer layer
```

---

## 5. ğŸ“Š ê°œì„  ì„±ê³¼

### ì •ëŸ‰ì  ê°œì„ 
- **íŒŒì¼ ì •ë¦¬**: 5ê°œ íŒŒì¼ ì´ë™, 3ê°œ ë¶ˆí•„ìš” íŒŒì¼ ì‚­ì œ
- **í‘œì¤€í™”**: 24ê°œ íŒŒì¼ì˜ ì´ë¦„ì„ ì§ê´€ì ì´ê³  ìˆœì°¨ì ì¸ ê·œì¹™(01~99)ìœ¼ë¡œ ë³€ê²½
- **ìµœì í™”**: 14ê°œì˜ ë¯¸ì‚¬ìš© ë³€ìˆ˜ë¥¼ ì œê±°í•˜ì—¬ `main.tf` ì½”ë“œ ë¼ì¸ ìˆ˜ 42% ê°ì†Œ
- **ê¸°ëŠ¥ ì¶”ê°€**: Compute ëª¨ë“ˆì— 4ê°œì˜ í•„ìˆ˜ ì¶œë ¥ê°’(Output) ì¶”ê°€

### ì •ì„±ì  ê°œì„ 
- âœ… **ê°€ë…ì„±**: íŒŒì¼ëª…ë§Œìœ¼ë¡œë„ ë¦¬ì†ŒìŠ¤ì˜ ì¢…ë¥˜ì™€ ìƒì„± ìˆœì„œë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŒ
- âœ… **ì•ˆì •ì„±**: ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš©ìœ¼ë¡œ ì‹¤í–‰ ìœ„ì¹˜ì— ë”°ë¥¸ ì˜¤ë¥˜ ê°€ëŠ¥ì„± ì œê±°
- âœ… **ìœ ì§€ë³´ìˆ˜ì„±**: ëª¨ë“ˆ ê°„ ì˜ì¡´ì„±ì´ ëª…í™•í•´ì§€ê³ , ë¶ˆí•„ìš”í•œ ë³€ìˆ˜ê°€ ì œê±°ë˜ì–´ ì½”ë“œ ìˆ˜ì •ì´ ìš©ì´í•´ì§
- âœ… **ìœ ì—°ì„±**: í•˜ë“œì½”ë”©ëœ ê°’ì„ ë³€ìˆ˜í™”í•˜ì—¬ ë¦¬ì „ ë³€ê²½ ë“±ì˜ ìš”êµ¬ì‚¬í•­ì— ì‰½ê²Œ ëŒ€ì‘ ê°€ëŠ¥

---

## 6. ğŸ” ê²€ì¦ ë° ë‹¤ìŒ ë‹¨ê³„

### ê²€ì¦ ì™„ë£Œ ì‚¬í•­
1. `terraform init -upgrade`: ëª¨ë“ˆ ë³€ê²½ ì‚¬í•­ ë°˜ì˜ ë° ì´ˆê¸°í™” ì™„ë£Œ
2. `terraform validate`: ë¬¸ë²•ì  ì˜¤ë¥˜ ì—†ìŒ í™•ì¸
3. `terraform fmt -recursive`: ì „ì²´ ì½”ë“œ í¬ë§·íŒ… ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„
1. **Terraform Plan**: `terraform plan`ì„ ì‹¤í–‰í•˜ì—¬ ì‹¤ì œ ì¸í”„ë¼ ë³€ê²½ ì‚¬í•­ì„ ìµœì¢… í™•ì¸í•©ë‹ˆë‹¤.
2. **Terraform Apply**: ë³€ê²½ ì‚¬í•­ì„ ì ìš©í•˜ì—¬ ì¸í”„ë¼ë¥¼ ë°°í¬í•©ë‹ˆë‹¤.
3. **í†µí•© í…ŒìŠ¤íŠ¸**: ë°°í¬ëœ ì¸í”„ë¼ì—ì„œ ì›¹ ì„œë²„ ì ‘ì†, DB ì—°ê²°, ë³µì œ ë™ì‘ ë“±ì„ ê²€ì¦í•©ë‹ˆë‹¤.
